---
title: "Prioritizing Potential Aquaculture Zones"
format: docx
editor: visual
author: Joaquin Sandoval 
date: 11/29/2025
---

## **Background** 

Marine aquaculture has the potential to play an important role in the global food supply as a more sustainable protein option than land-based meat production.^[1](https://eds-223-geospatial.github.io/assignments/HW4.html#fn1)^ [Gentry et al.](https://www.nature.com/articles/s41559-017-0257-9) mapped the potential for marine aquaculture globally based on multiple constraints, including ship traffic, dissolved oxygen, and bottom depth. They found that global seafood demand could be met using less than 0.015% of the global ocean area^[2](https://eds-223-geospatial.github.io/assignments/HW4.html#fn2)^

Import necessary packages

```{r, message = FALSE}
library(tidyverse)
library(here)
library(dplyr)
library(sf)
library(terra)
library(stars)
library(tmap)
library(kableExtra)
```

## Prepare data
Load all necessary data and make sure it has the coordinate reference system.

```{r, output = FALSE}

# Import Average Annual SST data from 2008-2012 

sst_2008 <- rast(here("data", "average_annual_sst_2008.tif"))
sst_2009 <- rast(here("data", "average_annual_sst_2009.tif"))
sst_2010 <- rast(here("data", "average_annual_sst_2010.tif"))
sst_2011 <- rast(here("data", "average_annual_sst_2011.tif"))
sst_2012 <- rast(here("data", "average_annual_sst_2012.tif"))

# Import bathymetry data

depth <- rast(here("data", "depth.tif"))

# Import exclusive economic zones off west coast 

regions <- st_read(here("data", "wc_regions_clean.shp"))
```

```{r}
crs(sst_2008) == crs(sst_2009)
crs(sst_2009) == crs(sst_2010)
crs(sst_2010) == crs(sst_2011)
crs(sst_2011) == crs(sst_2012)
```
## Process data

Find the mean SST from 2008-2012 (creating single raster stack of average SST) and convert average SST from Kelvin to Celsius by subtracting 273.15.

```{r}
# Create single raster stack of SST 

stacked_sst <- c(sst_2008, sst_2009, sst_2010, sst_2011, sst_2012)

# Find average and convert to Celsius  
avg_sst_c <- mean(stacked_sst) - 273.15

```

Process the SST, depth, and EEZ data so that they can be combined. In this case the SST and depth data have slightly different resolutions, extents, and positions. The CRS and extent of the EEZ shapefile need to updated as well. All need to match in order to proceed. 


```{r}
# Checking if CRS, resolutions, and extents of all data match.
crs(avg_sst_c) == crs(depth)
res(avg_sst_c) == res(depth)
ext(avg_sst_c) == ext(depth)

crs(avg_sst_c) == crs(regions)
ext(avg_sst_c) == ext(regions)

```
```{r}
# Converting CRS of bathymetry data to CRS of avg_sst_c

depth_transform <- project(x = depth, y = avg_sst_c)

# Verify CRS has updated
if(crs(depth_transform) == crs(avg_sst_c)) {
print("CRS of bathymetry data has updated.")
} else {
warning("CRS of bathymetry data has not updated.")
}

# Converting CRS of EEZ shapefile data to CRS of avg_sst_c

regions_transform <- st_transform(regions, crs(avg_sst_c))

# Verify CRS has updated
if(crs(regions_transform) == crs(avg_sst_c)) {
print("CRS of EEZ region data has updated.")
} else {
warning("CRS of EEZ region data has not updated.")
}

```

```{r}
# Crop extent of bathymetry data to extent of avg_sst_c

depth_cropped <- crop(depth_transform, avg_sst_c)

# Very 'depth_cropped' has fewer values

if(ncell(avg_sst_c) == nrow(depth_cropped)) {
warning("Clipping did not remove cells of bathymetry data.")
} else {
print("Clipping removed cells of bathymetry data.")
}
```

```{r}
# Resample the depth data to match the resolution of the SST data using the nearest neighbor approach

depth_resampled <- resample(depth_cropped, avg_sst_c, method = "near")

# Very 'depth_resampled' has same resolution as sst raster

if (all(res(avg_sst_c) == res(depth_resampled))) {
  print("Resolutions now match.")
} else {
  warning("Resolutions do not match.")
}

```


## Find suitable locations

To find suitable locations for marine aquaculture, locations must satisfy conditions for both SST and depth.

Reclassify SST and depth data into locations that are suitable for oysters

Oysters have optimal growth at depths between 0-70 meters below sea level and between 11-30°C. 

Create a reclassification matrix for both temperature and depth. 

```{r}
# Oyster reclassification matrix for temperature 

oyster_temp_rcl <- matrix(c(-Inf, 11, 0,
                            11, 30, 1,
                            30, Inf, 0), ncol = 3, byrow = TRUE)

# Reclassify oyster temperature 

reclassified_oyster_temp <- classify(avg_sst_c, rcl = oyster_temp_rcl)

# Oyster reclassification matrix for depth 

oyster_depth_rcl <- matrix(c(-Inf, -70, 0,
                             -70, 0, 1,
                             0, Inf, 0), ncol = 3, byrow = TRUE)

# Reclassify oyster depth

reclassified_oyster_depth <- classify(depth_resampled, rcl = oyster_depth_rcl )

```

To find suitable locations in which both depth and temperature requirements are met, multiply both reclassified variables. The following produces a raster in which the areas along the West Coast that are suitable for oysters are shaded. 

```{r}
# Finding suitable cells using map algebra 

suitable_oyster_env <- reclassified_oyster_temp * reclassified_oyster_depth
```

## Determine the most suitable EEZ

Determine the total suitable area within each EEZ in order to rank zones by priority. To do so, find the total area of suitable locations within each EEZ.

Select suitable cells within West Coast EEZs, find area of grid cells, and find the total suitable area within each EEZ. 


```{r, warning = FALSE, message = FALSE, output = FALSE}
# Mask to find suitable cells within EEZ area 

suitable_cells <- mask(suitable_oyster_env, regions_transform)

# Rasterize regions data 

regions_raster <- rasterize(regions_transform, suitable_cells, field = "rgn")

# Finding area of suitable cells 

area_raster <- cellSize(suitable_cells, unit = "km")

# Zonal algebra: Finding area of suitable cells within each EEZ zone: 

area_per_region <- zonal(suitable_cells *  area_raster, regions_raster, fun = "sum", na.rm = TRUE) |> 
  rename("suitable_area_km2" = mean)

# Left join to original regions dataframe 

regions_area <- left_join(regions_transform, area_per_region, by = "rgn")

# Creating summary table ranking each EEZ

regions_area |> 
  select(c("rgn", "suitable_area_km2")) |> 
  arrange(desc(suitable_area_km2)) |> 
  st_drop_geometry() |> 
  kable(col.names = c("Region", "Suitable Area (km²)"), 
        caption  = "Ranked Economic Exclusive Zones for Oyster Aquaculture")|> 
  kable_classic_2()
```

```{r, warning = FALSE, message = FALSE, ouput = FALSE}
# Plot 

tm_shape(regions_area) +
  tm_polygons("suitable_area_km2",
              palette = "Greens",
              style = "cont",
              title = "Suitable area (km²)") +
  tm_compass(position = c("left", "bottom")) + 
  tm_scalebar(position = c("left", "bottom")) + 
  tm_title("West Coast Exclusive Economic Zones for Oysters") + 
  tm_text("rgn") + 
  tm_basemap("Esri.OceanBasemap")
              

```

## Creating Function to Find Suitable EEZ's for California Spiny Lobster - Panulirus Interruptus.

After processing the data, create a generalizable function that takes the arguments of minimum temperature, maximum temperature, maximum depth, minimum depth, and species. This function will identify areas suitable for any species within each EEZ and rank them accordingly. The following code produces the same map as above for the California Spiny Lobster - Panulirus interruptus which occupies habitat between 0-150 meters below sea level and between 12-24°C. 

```{r, warning = FALSE}
tmap_mode("view")
suitable_habitat <- function(mintemp, maxtemp, maxdepth, mindepth, species_name) { 
  
# Species reclassification matrix for temperature 
  
species_temp_rcl <- matrix(c(-Inf, mintemp, 0,
                              mintemp, maxtemp, 1,
                              maxtemp, Inf, 0), ncol = 3, byrow = TRUE)
  
# Reclassify temperature 

reclassified_species_temp <- classify(avg_sst_c, rcl = species_temp_rcl)
  
# Species reclassification matrix for depth 
  
species_depth_rcl <- matrix(c(-Inf, maxdepth, 0,
                             maxdepth, mindepth, 1,
                             mindepth, Inf, 0), ncol = 3, byrow = TRUE)
  
# Reclassify species depth
  
reclassified_species_depth <- classify(depth_resampled, rcl = species_depth_rcl )
  
# Finding suitable cells using map algebra 

suitable_env <- reclassified_species_temp * reclassified_species_depth

# Mask to find suitable cells within EEZ area 

suitable_cells <- mask(suitable_env, regions_transform)

# Rasterize regions data 

regions_raster <- rasterize(regions_transform, suitable_cells, field = "rgn")


# Finding area of suitable cells 

area_raster <- cellSize(suitable_cells, unit = "km")

# Zonal algebra: Finding area of suitable cells within each EEZ zone: 

area_per_region <- zonal(suitable_cells *  area_raster, regions_raster, fun = "sum", na.rm = TRUE) |> 
  rename("suitable_area_km2" = mean)


# Left join to original regions dataframe 

regions_area <- left_join(regions_transform, area_per_region, by = "rgn")

 
# Plot

tm_shape(regions_area) +
  tm_polygons("suitable_area_km2",
              palette = "Greens",
              style = "cont",
              title = "Suitable area (km²)") +
  tm_compass(position = c("left", "bottom")) + 
  tm_scalebar(position = c("left", "bottom")) + 
  tm_title(paste("West Coast Exclusive Economic Zones for", species_name)) + 
  tm_text("rgn") + 
  tm_basemap("Esri.OceanBasemap")
  
}

suitable_habitat(12, 24, -150, 0, "Panulirus interruptus")
```

## Interpretations 

After processing and analyzing the data, the EEZ regions most suitable for aquaculture of several oyster species and the California Spiny Lobster were identified. For oysters, the regions ranked by total suitable area are: Central California > Southern California > Washington > Oregon > Northern California. For the California Spiny Lobster, the habitat suitability function 'suitable_habitat' produced a second map. The regions ranked by suitable area are: Southern California > Central California > Oregon > Washington > Northern California. 

